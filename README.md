# 3 курс
# Крупина Полина Андреевна
# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ - исходные файлы проекта
- src/components/ - папка с JS компонентами
- src/components/base/ - папка с базовым кодом

Важные файлы:
- src/pages/index.html - HTML-файл главной страницы
- src/types.ts - файл с типами
- src/index.ts - точка входа приложения
- src/scss/styles.scss - корневой файл стилей
- src/utils/constants.ts - файл с константами
- src/utils/utils.ts - файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура проекта
Архитектура приложения базируется на паттерне MVP:

Model: Управляет бизнес-логикой и состоянием данных, такими как товары, корзина и заказы.
View: Отвечает за отображение данных и взаимодействие с пользователем.
Presenter: Обрабатывает логику взаимодействия между Model и View, контролируя действия пользователя и обновления данных.

## Описание типов данных
Основные типы данных описаны в файле src/types.ts:

IProduct - тип данных для представления товара:
- id: string - уникальный идентификатор товара;
- title: string - название товара, которое видит пользователь;
- category: string - категория товара;
- description: string - описание товара;
- image: string - URL-адрес изображения товара;
- price: number | null - стоимость товара.

IOrder: тип данных для оформления заказа:
- payment: string - способ оплаты;
- address: string - адрес доставки пользователя;
- email: string - электронная почта пользователя;
- phone: string - номер телефона пользователя;
- total: number - общая сумма заказа;
- items: string[] - список id всех элеметов заказа.

IOrderForm: тип данных для формы заказа:
- payment: string - способ оплаты;
- address: string - адрес доставки;
- email: string - электронная почта;
- phone: string - номер телефона.

IForm: тип данных для формы:
- valid: boolean - флаг, показывающий валидна ли форма;
- errors: string[] - список ошибок.

IAppState: тип данных для состояния приложения:
- products: IProduct[] - массив всех доступных товаров;
- basket: IProduct[] - массив товаров, добавленных в корзину;
- preview: string | null - данные для превью;
- order: IOrder - объект заказа, содержащий текущие данные, введённые пользователем.

IOrderResult: тип данных для результата заказа:
- total: number - итоговая сумма.

## Классы

### Класс EventEmitter
Класс отвечает за управление событиями в приложении. Он предоставляет методы для подписки на события, отписки от них, генерации событий и уведомления подписчиков.

Поля:
- _events: Map<EventName, Set<Subscriber>> - хранилище событий и их подписчиков.

Методы:
- on - подписка на событие;
- off - отписка от события;
- emit - уведомления подписчиков о наступлении события;
- onAll - подписка на все события;
- offAll - удаляет все обработчики событий;
- trigger - создаёт функцию, которая автоматически вызывает событие с указанными данными.

### Класс API
Класс отвечает за взаимодействие с сервером и выполнение HTTP-запросов.

Поля:
- baseUrl: string - ссылка для запроса;
- options: RequestInit - опции, передаваемые в параметры запроса.

Методы: 
- get - выполняет GET запрос, возвращает промис с объектом, которым ответил сервер;
- post - отправляет переданные данные на указанный адрес.

### Класс Component
Базовый класс для всех компонентов слоя представления. Предоставляет базовый набор инструментов для управления DOM и взаимодействия с дочерними компонентами.

Поля:
- container: HTMLElement - основной контейнер компонента, передаваемый при инициализации.

Методы:
- toggleClass - переключает класс на переданном элементе;
- setText - устанавливает текстовое содержимое элемента;
- setDisabled - устанавливает или снимает атрибут disabled у элемента;
- setHidden - скрывает элемент, устанавливая для него стиль display: none;
- setVisible - делает элемент видимым, удаляя стиль display: none;
- setImage - устанавливает источник изображения и альтернативный текст;
- render - основной метод для обновления данных и возвращения DOM-элемента.

### Класс Model
Базовый класс для моделей данных, предоставляет методы для управления данными и уведомления об их изменениях.

Поля:
- events: IEvents - экземпляр класса EventEmitter для управления событиями.

Методы:
- emitChanges - генерирует событие, уведомляя подписчиков об изменениях модели;
- isModel - статический метод, проверяющий, является ли переданный объект экземпляром класса Model.

### Класс AppState
Класс отвечает за хранение и логику работы с данными приложения. 

Поля:
- basket: CardItem[] - список товаров в корзине;
- basketTotal: number - сумма;
- catalog: CardItem[] - каталог товаров;
- preview: string - данные для превью;
- formErrors: FormErrors - объект ошибок;
- order: IOrder - объект заказа.

Методы:
- getCard - возвращает карточку по ее id;
- setCatalog - устанавливает каталог;
- setBasket - устанавливает данные корзины;
- clearBasket - очищает корзину;
- clearOrder - очищает заказ;
- setItems - наполняет заказ товарами;
- getBasket - получает данные корзины;
- checkCard - проверяет карточки;
- setPreview - устанавливает превью;
- removeFromBasket - убирает из корзины;
- getTotal - возвращает сумму;
- getBasketNumber - возвращает количество товаров в корзине;
- setOrderField - заполняет поля заказа;
- validateOrder - валидация.

### Класс Modal
Класс реализует модальное окно, предоставляет методы open и close для управления отображением.

Поля:
- content: HTMLElement - контейнер для вставки;
- events: IEvents - брокер событий;
- closeButton: HTMLButtonElement - кнопка закрытия.

Методы:
- set content - сеттер, вставляет контент в контейнер модального окна;
- open - открывает модальное окно;
- close - закрывает модальное окно;
- render - отрисовывает модальное окно.

### Класс Card
Класс для создания карточек товаров. Позволяет управлять данными карточки, ее отображением и взаимодействием с пользователем.

Поля:
- blockName: string - имя блока для работы с CSS-классами;
- _title: HTMLElement - элемент заголовка карточки;
- _category: HTMLElement - элемент категории карточки;
- _image?: HTMLImageElement - элемент изображения карточки;
- _description?: HTMLElement - элемент описания карточки;
- _price: HTMLElement - элемент цены карточки;
- _button?: HTMLButtonElement - кнопка действия карточки.

Методы:
- id - геттер и сеттер для ID карточки;
- price - геттер и сеттер для цены карточки;
- category - сеттер для категории карточки;
- title - геттер и сеттер для заголовка карточки;
- image - сеттер для изображения карточки;
- description - сеттер для описания карточки;
- buttonDisable - устанавливает состояние блокировки кнопки.

### Класс BasketCard
Класс используется для работы с карточками товаров, добавленных в корзину.

Поля:
- blockName: string - имя блока для работы с CSS-классами;
- _title: HTMLElement - элемент заголовка карточки;
- _price: HTMLElement - элемент цены карточки;
- _button?: HTMLButtonElement - кнопка действия карточки;
- _listNumber: HTMLElement - элемент отображения порядкового номера карточки.

Методы:
- title - геттер и сеттер для заголовка карточки;
- listNumber - сеттер для номера карточки;
- price - геттер и сеттер для цены карточки.

### Класс Form
Класс для работы с формами. Предоставляет функционал для валидации, работы с ошибками и отправки данных.

Поля:
- container: HTMLFormElement - элемент формы;
- _submit: HTMLButtonElement - кнопка отправки формы;
- _errors: HTMLElement - контейнер для отображения ошибок.

Методы:
- onInputChange - обрабатывает изменение значения в поле ввода;
- valid - сеттер для состояния валидности формы;
- errors - сеттер для отображения ошибок формы;
- render - обновляет состояние формы;
- reset - сбрасывает форму до начального состояния;
- buttonDisable - устанавливает состояние блокировки кнопки.

### Класс Order
Класс расширяет функционал формы для работы с заказами, включая выбор способа оплаты и валидацию.

Поля:
- _btnCollection: HTMLButtonElement[] - коллекция кнопок выбора способа оплаты;
- inputCollection: HTMLInputElement[] - коллекция полей ввода формы.

Методы:
- changeClass - изменяет CSS-класс кнопок в зависимости от выбранного способа оплаты;
- updateButtonState - проверяет валидность полей ввода и изменяет состояние кнопки.

### Класс Page
Класс отвечает за создание и управление компонентами страницы, такими как каталог товаров и корзина.

Поля:
- _counter: HTMLElement - элемент, отображающий количество товаров в корзине;
- _catalog: HTMLElement - контейнер для отображения карточек товаров;
- _wrapper: HTMLElement - общий контейнер страницы;
- _basket: HTMLElement - элемент интерфейса для корзины.

Методы:
- set counter - устанавливает значение счетчика товаров в корзине;
- set catalog - заменяет содержимое каталога переданными элементами;
- set locked - блокирует или разблокирует взаимодействие с контейнером страницы.

### Класс Basket
Класс представляет компонент корзины, управляет отображением списка товаров и итоговой стоимости и обработкой событий, связанных с корзиной.

Поля:
- _list: HTMLElement - список товаров в корзине;
- _total: HTMLElement - итоговая стоимость товаров;
- _button: HTMLElement - кнопка оформления заказа.

Методы:
- set items - обновляет отображение товаров в корзине;
- set total - обновляет отображение итоговой стоимости.

### Класс Success
Класс предназначен для отображения уведомления об успешной операции.

Поля:
- _close: HTMLElement - кнопка закрытия уведомления;
- _total: HTMLElement - элемент, отображающий общую сумму списания.

Методы:
- set total - устанавливает и отображает сумму списания.

### Класс WebLarekAPI
Класс для работы с API проекта, включает методы для получения данных и выполнения запросов.

Поля:
- cdn: string - базовый URL для загрузки изображений.

Методы:
- getCardList - отправляет запрос на получение списка товаров;
- getCardItem - отправляет запрос на получение данных конкретного товара;
- orderLots - отправляет заказ на сервер.

## Взаимодействие компонентов
1. Пользователь взаимодействует с карточками товара на странице.
2. Компонент Card вызывает событие выбора карточки.
3. Событие обрабатывается в Presenter, который обновляет состояние через AppState.
4. При добавлении товара в корзину обновляются соответствующие данные, а BasketCard отображает актуальную корзину.
5. После оформления заказа WebLarekApi отправляет данные на сервер, а Success отображает уведомление о результате.

## Список всех событий:
- card:select - установить карточку для превью
- basket:open - открыть корзину
- basket:delete-item - удалить из корзины
- basket:changed - изменение корзины
- catalog:changed - изменение каталога
- preview:open - открыть превью
- order:open - открыть форму заказа
- /^order\..*:change/ - отслеживание изменения формы
- /^contacts\..*:change/ - отслеживание изменения формы
- contacts:open - открыть форму заказа с контактными данными
- contacts:submit - отправка формы
- payment:select - установить тип оплаты
- formErrors:change - показ ошибок
- modal:open - открыть модальное окно
- modal:close - закрыть модальное окно